<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="egovframework.AIExam_Tester.home.service.impl.BoardMapper">
	<!-- 병원이름 -->
	<select id="getOrgNm" resultType="String">
		SELECT TCI.ORG_NM
		FROM tc_cm_inst AS TCI
		WHERE 1=1
		AND	TCI.USE_YN = 'Y'
	</select>
	
	<!-- 문제 갯수가져오기 -->
	<select id="examCnt" parameterType="BoardVO" resultType="int">
		SELECT count(*)
		FROM tm_cm_kdsqc_item AS TCKI
		WHERE 1=1
		AND TCKI.TRGTER = #{trgter}
		AND TCKI.USE_YN = 'Y'
	</select>
	
	<!-- 문제가져오기 -->
	<select id="loadExamItem" parameterType="BoardVO" resultType="BoardVO">
		SELECT @rownum:=@rownum+1 AS no, TCKI.EXAM_ITEM_CD AS examItemCd, TCKI.EXAM_ITEM AS examItem, TCKI.TRGTER AS trgter
		FROM tm_cm_kdsqc_item AS TCKI, 
			(SELECT @rownum:=0) TMP
		WHERE 1=1
		AND TCKI.TRGTER = #{trgter}
		AND TCKI.USE_YN = 'Y'
	</select>
	
	<!-- 기기사용여부 확인 -->
	<select id="checkInst" resultType="String">
		SELECT TCI.USE_YN
		FROM tc_cm_inst AS TCI
		WHERE 1=1
	</select>
	
	<!-- 기관코드 -->
	<select id="loadOrgCd" parameterType="InstVO" resultType="String">
		SELECT TCI.ORG_CD AS orgCd
		FROM tc_cm_inst AS TCI
		WHERE 1=1
		AND TCI.USE_YN = #{useYn}
	</select>
	
	<!-- 기기코드 -->
	<select id="loadInstCd" parameterType="InstVO" resultType="String">
		SELECT TCI.INST_CD AS instCd
		FROM tc_cm_inst AS TCI
		WHERE 1=1
		AND TCI.USE_YN = #{useYn}
	</select>
	
	<insert id="saveRes" parameterType="ResultVO">
		INSERT INTO tm_cm_kdsqc_res
		VALUES(#{rNumber}, #{trgter}, #{examItemCd}, #{resOx}, #{ckUp})
	</insert>
	
	<!-- 답안가져오기 -->
	<select id="loadExamRes" parameterType="ResultVO" resultType="ResultVO">
		SELECT TCKR.R_NUMBER AS rNumber, EXAM_ITEM_CD AS examItemCd, TCKR.RES_OX AS resOx
		FROM tm_cm_kdsqc_res AS TCKR
		WHERE 1=1
		AND TCKR.R_NUMBER = #{rNumber}
		AND TCKR.TRGTER = #{trgter}
	</select>
	
	<!-- 답안가져오기 -->
	<select id="loadExamResCnt" parameterType="ResultVO" resultType="int">
		SELECT COUNT(*)
		FROM tm_cm_kdsqc_res AS TCKR
		WHERE 1=1
		AND TCKR.R_NUMBER = #{rNumber}
		AND TCKR.TRGTER = #{trgter}
		AND TCKR.RES_OX = 'O'
	</select>
	
</mapper>